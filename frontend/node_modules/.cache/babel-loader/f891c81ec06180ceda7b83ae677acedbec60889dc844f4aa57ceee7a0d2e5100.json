{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { ref, onMounted, computed, watch } from \"vue\";\nimport { getVenueById } from \"@/api/venue\";\nimport { createOrder, getBookedSlots } from \"@/api/order\";\nimport { useUserStore } from \"@/store/user\";\n// ===================================================================================\n\nexport default {\n  __name: 'VenueDetailView',\n  props: {\n    id: {\n      type: [String, Number],\n      required: true\n    }\n  },\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n\n    // ==================== 问题修复：移除了未使用的 reactive 和 useRouter ====================\n    const props = __props;\n    const {\n      userState,\n      isLoggedIn\n    } = useUserStore();\n    const venue = ref(null);\n    const loading = ref(true);\n    const isBooking = ref(false);\n    const bookingMessage = ref(\"\");\n    const isError = ref(false);\n    const selectedDate = ref(new Date().toISOString().split(\"T\")[0]);\n    const bookedSlots = ref([]);\n    const selectedSlot = ref(null);\n\n    // 生成一天的时间段 (9:00 - 21:00)\n    const timeSlots = computed(() => {\n      const slots = [];\n      for (let i = 9; i < 22; i++) {\n        const time = `${String(i).padStart(2, \"0\")}:00`;\n        // 检查这个时间段是否已被预订\n        const isBooked = bookedSlots.value.some(booking => {\n          const startTime = booking.startTime.substring(0, 5); // '09:00:00' -> '09:00'\n          return startTime === time;\n        });\n        slots.push({\n          time,\n          isBooked\n        });\n      }\n      return slots;\n    });\n\n    // 获取某日已预订时段\n    const fetchBookedSlots = async date => {\n      if (!isLoggedIn.value) return;\n      try {\n        const data = await getBookedSlots(props.id, date);\n        bookedSlots.value = data;\n        selectedSlot.value = null; // 日期改变后清空选择\n      } catch (error) {\n        console.error(\"获取已预约时段失败:\", error);\n      }\n    };\n\n    // 监听日期变化，重新获取数据\n    watch(selectedDate, newDate => {\n      fetchBookedSlots(newDate);\n    });\n\n    // 点击选择时间段\n    const selectSlot = slot => {\n      if (slot.isBooked) return; // 已被预订的不能选\n      selectedSlot.value = slot.time;\n    };\n    const handleBooking = async () => {\n      if (!selectedSlot.value) {\n        alert(\"请先选择一个预约时间段！\");\n        return;\n      }\n      isBooking.value = true;\n      bookingMessage.value = \"\";\n      try {\n        const startTime = selectedSlot.value;\n        const endTime = `${(parseInt(startTime.split(\":\")[0]) + 1).toString().padStart(2, \"0\")}:00`;\n        await createOrder({\n          userId: userState.userInfo.id,\n          venueId: venue.value.id,\n          bookingDate: selectedDate.value,\n          startTime,\n          endTime\n        });\n        isError.value = false;\n        bookingMessage.value = \"恭喜，预约成功！\";\n        alert('预约成功！您可以在\"我的订单\"页面查看。');\n        // 预约成功后刷新当前页的预订状态\n        fetchBookedSlots(selectedDate.value);\n      } catch (error) {\n        isError.value = true;\n        bookingMessage.value = error.message || \"预约失败，请稍后再试。\";\n      } finally {\n        isBooking.value = false;\n      }\n    };\n    onMounted(async () => {\n      try {\n        loading.value = true;\n        venue.value = await getVenueById(props.id);\n        await fetchBookedSlots(selectedDate.value); // 初始加载当天的预订\n      } catch (error) {\n        console.error(\"获取场馆详情失败:\", error);\n      } finally {\n        loading.value = false;\n      }\n    });\n    const __returned__ = {\n      props,\n      userState,\n      isLoggedIn,\n      venue,\n      loading,\n      isBooking,\n      bookingMessage,\n      isError,\n      selectedDate,\n      bookedSlots,\n      selectedSlot,\n      timeSlots,\n      fetchBookedSlots,\n      selectSlot,\n      handleBooking,\n      ref,\n      onMounted,\n      computed,\n      watch,\n      get getVenueById() {\n        return getVenueById;\n      },\n      get createOrder() {\n        return createOrder;\n      },\n      get getBookedSlots() {\n        return getBookedSlots;\n      },\n      get useUserStore() {\n        return useUserStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","watch","getVenueById","createOrder","getBookedSlots","useUserStore","props","__props","userState","isLoggedIn","venue","loading","isBooking","bookingMessage","isError","selectedDate","Date","toISOString","split","bookedSlots","selectedSlot","timeSlots","slots","i","time","String","padStart","isBooked","value","some","booking","startTime","substring","push","fetchBookedSlots","date","data","id","error","console","newDate","selectSlot","slot","handleBooking","alert","endTime","parseInt","toString","userId","userInfo","venueId","bookingDate","message"],"sources":["F:/Java_web_code/frontend/src/views/VenueDetailView.vue"],"sourcesContent":["<template>\n  <div class=\"detail-page\">\n    <div v-if=\"loading\">加载中...</div>\n    <div v-if=\"venue\">\n      <div class=\"venue-header\">\n        <div\n          class=\"header-image\"\n          :style=\"{\n            backgroundImage: `url(${\n              venue.imageUrl ||\n              `https://picsum.photos/seed/${venue.id}/1200/400`\n            })`,\n          }\"\n        ></div>\n        <div class=\"header-content\">\n          <span class=\"type-tag\">{{ venue.type }}</span>\n          <h1 class=\"page-title\">{{ venue.name }}</h1>\n          <p>{{ venue.description }}</p>\n        </div>\n      </div>\n\n      <div class=\"booking-container\">\n        <div class=\"info-cards\">\n          <div class=\"info-card\">\n            <span>价格</span><strong>¥{{ venue.pricePerHour }}/小时</strong>\n          </div>\n          <div class=\"info-card\">\n            <span>容量</span><strong>{{ venue.capacity }} 人</strong>\n          </div>\n        </div>\n\n        <div class=\"booking-panel\">\n          <h3>立即预约</h3>\n          <div v-if=\"isLoggedIn\">\n            <div class=\"form-group\">\n              <label>选择日期</label>\n              <input type=\"date\" v-model=\"selectedDate\" />\n            </div>\n            <label>选择时段 (每小时)</label>\n            <div class=\"time-slots-grid\">\n              <div\n                v-for=\"slot in timeSlots\"\n                :key=\"slot.time\"\n                class=\"time-slot\"\n                :class=\"{\n                  booked: slot.isBooked,\n                  selected: selectedSlot === slot.time,\n                }\"\n                @click=\"selectSlot(slot)\"\n              >\n                {{ slot.time }}\n              </div>\n            </div>\n            <p\n              v-if=\"bookingMessage\"\n              :class=\"isError ? 'error-text' : 'success-text'\"\n            >\n              {{ bookingMessage }}\n            </p>\n            <button\n              @click=\"handleBooking\"\n              class=\"book-btn\"\n              :disabled=\"!selectedSlot || isBooking\"\n            >\n              {{ isBooking ? \"处理中...\" : `确认预约 ${selectedSlot || \"\"}` }}\n            </button>\n          </div>\n          <div v-else class=\"login-prompt\">\n            <p>请先登录以查看可预约时段并进行预约。</p>\n            <router-link to=\"/login\" class=\"book-btn\">前往登录</router-link>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\n// ==================== 问题修复：移除了未使用的 reactive 和 useRouter ====================\nimport { ref, onMounted, computed, watch, defineProps } from \"vue\";\nimport { getVenueById } from \"@/api/venue\";\nimport { createOrder, getBookedSlots } from \"@/api/order\";\nimport { useUserStore } from \"@/store/user\";\n// ===================================================================================\n\nconst props = defineProps({ id: { type: [String, Number], required: true } });\nconst { userState, isLoggedIn } = useUserStore();\n\nconst venue = ref(null);\nconst loading = ref(true);\nconst isBooking = ref(false);\nconst bookingMessage = ref(\"\");\nconst isError = ref(false);\n\nconst selectedDate = ref(new Date().toISOString().split(\"T\")[0]);\nconst bookedSlots = ref([]);\nconst selectedSlot = ref(null);\n\n// 生成一天的时间段 (9:00 - 21:00)\nconst timeSlots = computed(() => {\n  const slots = [];\n  for (let i = 9; i < 22; i++) {\n    const time = `${String(i).padStart(2, \"0\")}:00`;\n    // 检查这个时间段是否已被预订\n    const isBooked = bookedSlots.value.some((booking) => {\n      const startTime = booking.startTime.substring(0, 5); // '09:00:00' -> '09:00'\n      return startTime === time;\n    });\n    slots.push({ time, isBooked });\n  }\n  return slots;\n});\n\n// 获取某日已预订时段\nconst fetchBookedSlots = async (date) => {\n  if (!isLoggedIn.value) return;\n  try {\n    const data = await getBookedSlots(props.id, date);\n    bookedSlots.value = data;\n    selectedSlot.value = null; // 日期改变后清空选择\n  } catch (error) {\n    console.error(\"获取已预约时段失败:\", error);\n  }\n};\n\n// 监听日期变化，重新获取数据\nwatch(selectedDate, (newDate) => {\n  fetchBookedSlots(newDate);\n});\n\n// 点击选择时间段\nconst selectSlot = (slot) => {\n  if (slot.isBooked) return; // 已被预订的不能选\n  selectedSlot.value = slot.time;\n};\n\nconst handleBooking = async () => {\n  if (!selectedSlot.value) {\n    alert(\"请先选择一个预约时间段！\");\n    return;\n  }\n  isBooking.value = true;\n  bookingMessage.value = \"\";\n\n  try {\n    const startTime = selectedSlot.value;\n    const endTime = `${(parseInt(startTime.split(\":\")[0]) + 1)\n      .toString()\n      .padStart(2, \"0\")}:00`;\n\n    await createOrder({\n      userId: userState.userInfo.id,\n      venueId: venue.value.id,\n      bookingDate: selectedDate.value,\n      startTime,\n      endTime,\n    });\n\n    isError.value = false;\n    bookingMessage.value = \"恭喜，预约成功！\";\n    alert('预约成功！您可以在\"我的订单\"页面查看。');\n    // 预约成功后刷新当前页的预订状态\n    fetchBookedSlots(selectedDate.value);\n  } catch (error) {\n    isError.value = true;\n    bookingMessage.value = error.message || \"预约失败，请稍后再试。\";\n  } finally {\n    isBooking.value = false;\n  }\n};\n\nonMounted(async () => {\n  try {\n    loading.value = true;\n    venue.value = await getVenueById(props.id);\n    await fetchBookedSlots(selectedDate.value); // 初始加载当天的预订\n  } catch (error) {\n    console.error(\"获取场馆详情失败:\", error);\n  } finally {\n    loading.value = false;\n  }\n});\n</script>\n\n<style scoped>\n.venue-header {\n  position: relative;\n  border-radius: var(--border-radius);\n  overflow: hidden;\n  margin-bottom: 32px;\n}\n.header-image {\n  height: 300px;\n  background-size: cover;\n  background-position: center;\n}\n.header-content {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  padding: 60px 32px 32px;\n  background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);\n  color: white;\n}\n.header-content .page-title {\n  margin: 8px 0;\n  color: white;\n}\n.header-content p {\n  margin: 0;\n  opacity: 0.9;\n}\n\n.booking-container {\n  display: grid;\n  grid-template-columns: 1fr 350px;\n  gap: 32px;\n}\n.info-cards {\n  background: var(--card-bg);\n  padding: 32px;\n  border-radius: var(--border-radius);\n  box-shadow: 0 4px 6px -1px var(--shadow-color);\n  align-self: flex-start; /* 关键，让它不拉伸 */\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 20px;\n}\n.info-card span {\n  display: block;\n  color: var(--text-secondary);\n  margin-bottom: 8px;\n}\n.info-card strong {\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.booking-panel {\n  background: var(--card-bg);\n  padding: 32px;\n  border-radius: var(--border-radius);\n  box-shadow: 0 4px 6px -1px var(--shadow-color);\n}\n.booking-panel h3 {\n  margin: 0 0 24px;\n  font-size: 20px;\n}\n.form-group {\n  margin-bottom: 16px;\n}\n.form-group label,\n.booking-panel > label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 500;\n  font-size: 14px;\n}\n.form-group input {\n  width: 100%;\n  padding: 10px;\n  border: 1px solid var(--border-color);\n  border-radius: 6px;\n  box-sizing: border-box;\n}\n\n.time-slots-grid {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 8px;\n  margin-bottom: 24px;\n}\n.time-slot {\n  padding: 8px;\n  border: 1px solid var(--border-color);\n  border-radius: 6px;\n  text-align: center;\n  cursor: pointer;\n}\n.time-slot.booked {\n  background: #f1f5f9;\n  color: #94a3b8;\n  cursor: not-allowed;\n  text-decoration: line-through;\n}\n.time-slot.selected {\n  background: var(--primary-color);\n  color: white;\n  border-color: var(--primary-color);\n}\n\n.book-btn {\n  width: 100%;\n  padding: 12px;\n  border: none;\n  border-radius: 6px;\n  background: var(--primary-color);\n  color: white;\n  font-size: 16px;\n  cursor: pointer;\n  text-align: center;\n  text-decoration: none;\n}\n.book-btn:disabled {\n  background: #cbd5e1;\n  cursor: not-allowed;\n}\n\n.error-text {\n  color: #ef4444;\n}\n.success-text {\n  color: #22c55e;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}