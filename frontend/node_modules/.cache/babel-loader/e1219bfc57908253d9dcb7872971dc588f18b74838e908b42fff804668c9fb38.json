{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { createRouter, createWebHistory } from \"vue-router\";\nimport VenueListView from \"../views/VenueListView.vue\";\nimport LoginRegisterView from \"../views/LoginRegisterView.vue\";\nimport VenueDetailView from \"../views/VenueDetailView.vue\";\nimport MyOrdersView from \"../views/MyOrdersView.vue\";\n// ======== 修复：导入 AdminVenueEdit 组件 ========\nimport AdminVenueEdit from \"../views/AdminVenueEdit.vue\";\nconst routes = [{\n  path: \"/\",\n  redirect: \"/venues\"\n}, {\n  path: \"/venues\",\n  name: \"VenueList\",\n  component: VenueListView\n}, {\n  path: \"/venue/:id\",\n  name: \"VenueDetail\",\n  component: VenueDetailView,\n  props: true\n}, {\n  path: \"/login\",\n  name: \"LoginRegister\",\n  component: LoginRegisterView\n}, {\n  path: \"/my-orders\",\n  name: \"MyOrders\",\n  component: MyOrdersView,\n  meta: {\n    requiresAuth: true\n  } // 添加元信息，表示此路由需要登录\n}, {\n  path: \"/about\",\n  name: \"about\",\n  component: () => import(\"../views/AboutView.vue\")\n},\n// ======== 新增后台路由 ========\n{\n  path: \"/admin/venue/new\",\n  name: \"AdminVenueNew\",\n  component: AdminVenueEdit,\n  meta: {\n    requiresAuth: true,\n    requiresAdmin: true\n  } // 需要登录且是管理员\n}, {\n  path: \"/admin/venue/edit/:id\",\n  name: \"AdminVenueEdit\",\n  component: AdminVenueEdit,\n  meta: {\n    requiresAuth: true,\n    requiresAdmin: true\n  } // 需要登录且是管理员\n}];\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\n\n// 全局前置守卫 (Navigation Guard)\nrouter.beforeEach((to, from, next) => {\n  const userInfo = JSON.parse(localStorage.getItem(\"userInfo\"));\n  const loggedIn = !!userInfo;\n  const isAdmin = loggedIn && userInfo.isAdmin === 1;\n  if (to.matched.some(record => record.meta.requiresAdmin)) {\n    // 如果目标路由需要管理员权限\n    if (isAdmin) {\n      next(); // 是管理员，放行\n    } else if (loggedIn) {\n      alert(\"权限不足！\");\n      next(\"/venues\"); // 已登录但不是管理员，跳回首页\n    } else {\n      next(\"/login\"); // 未登录，去登录\n    }\n  } else if (to.matched.some(record => record.meta.requiresAuth) && !loggedIn) {\n    // 如果目标路由需要登录，但未登录\n    next(\"/login\");\n  } else {\n    next();\n  }\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","VenueListView","LoginRegisterView","VenueDetailView","MyOrdersView","AdminVenueEdit","routes","path","redirect","name","component","props","meta","requiresAuth","requiresAdmin","router","history","process","env","BASE_URL","beforeEach","to","from","next","userInfo","JSON","parse","localStorage","getItem","loggedIn","isAdmin","matched","some","record","alert"],"sources":["F:/Java_web_code/frontend/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from \"vue-router\";\nimport VenueListView from \"../views/VenueListView.vue\";\nimport LoginRegisterView from \"../views/LoginRegisterView.vue\";\nimport VenueDetailView from \"../views/VenueDetailView.vue\";\nimport MyOrdersView from \"../views/MyOrdersView.vue\";\n// ======== 修复：导入 AdminVenueEdit 组件 ========\nimport AdminVenueEdit from \"../views/AdminVenueEdit.vue\";\n\nconst routes = [\n  { path: \"/\", redirect: \"/venues\" },\n  { path: \"/venues\", name: \"VenueList\", component: VenueListView },\n  {\n    path: \"/venue/:id\",\n    name: \"VenueDetail\",\n    component: VenueDetailView,\n    props: true,\n  },\n  { path: \"/login\", name: \"LoginRegister\", component: LoginRegisterView },\n  {\n    path: \"/my-orders\",\n    name: \"MyOrders\",\n    component: MyOrdersView,\n    meta: { requiresAuth: true }, // 添加元信息，表示此路由需要登录\n  },\n  {\n    path: \"/about\",\n    name: \"about\",\n    component: () => import(\"../views/AboutView.vue\"),\n  },\n  // ======== 新增后台路由 ========\n  {\n    path: \"/admin/venue/new\",\n    name: \"AdminVenueNew\",\n    component: AdminVenueEdit,\n    meta: { requiresAuth: true, requiresAdmin: true }, // 需要登录且是管理员\n  },\n  {\n    path: \"/admin/venue/edit/:id\",\n    name: \"AdminVenueEdit\",\n    component: AdminVenueEdit,\n    meta: { requiresAuth: true, requiresAdmin: true }, // 需要登录且是管理员\n  },\n];\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes,\n});\n\n// 全局前置守卫 (Navigation Guard)\nrouter.beforeEach((to, from, next) => {\n  const userInfo = JSON.parse(localStorage.getItem(\"userInfo\"));\n  const loggedIn = !!userInfo;\n  const isAdmin = loggedIn && userInfo.isAdmin === 1;\n\n  if (to.matched.some((record) => record.meta.requiresAdmin)) {\n    // 如果目标路由需要管理员权限\n    if (isAdmin) {\n      next(); // 是管理员，放行\n    } else if (loggedIn) {\n      alert(\"权限不足！\");\n      next(\"/venues\"); // 已登录但不是管理员，跳回首页\n    } else {\n      next(\"/login\"); // 未登录，去登录\n    }\n  } else if (\n    to.matched.some((record) => record.meta.requiresAuth) &&\n    !loggedIn\n  ) {\n    // 如果目标路由需要登录，但未登录\n    next(\"/login\");\n  } else {\n    next();\n  }\n});\n\nexport default router;\n"],"mappings":";;AAAA,SAASA,YAAY,EAAEC,gBAAgB,QAAQ,YAAY;AAC3D,OAAOC,aAAa,MAAM,4BAA4B;AACtD,OAAOC,iBAAiB,MAAM,gCAAgC;AAC9D,OAAOC,eAAe,MAAM,8BAA8B;AAC1D,OAAOC,YAAY,MAAM,2BAA2B;AACpD;AACA,OAAOC,cAAc,MAAM,6BAA6B;AAExD,MAAMC,MAAM,GAAG,CACb;EAAEC,IAAI,EAAE,GAAG;EAAEC,QAAQ,EAAE;AAAU,CAAC,EAClC;EAAED,IAAI,EAAE,SAAS;EAAEE,IAAI,EAAE,WAAW;EAAEC,SAAS,EAAET;AAAc,CAAC,EAChE;EACEM,IAAI,EAAE,YAAY;EAClBE,IAAI,EAAE,aAAa;EACnBC,SAAS,EAAEP,eAAe;EAC1BQ,KAAK,EAAE;AACT,CAAC,EACD;EAAEJ,IAAI,EAAE,QAAQ;EAAEE,IAAI,EAAE,eAAe;EAAEC,SAAS,EAAER;AAAkB,CAAC,EACvE;EACEK,IAAI,EAAE,YAAY;EAClBE,IAAI,EAAE,UAAU;EAChBC,SAAS,EAAEN,YAAY;EACvBQ,IAAI,EAAE;IAAEC,YAAY,EAAE;EAAK,CAAC,CAAE;AAChC,CAAC,EACD;EACEN,IAAI,EAAE,QAAQ;EACdE,IAAI,EAAE,OAAO;EACbC,SAAS,EAAEA,CAAA,KAAM,MAAM,CAAC,wBAAwB;AAClD,CAAC;AACD;AACA;EACEH,IAAI,EAAE,kBAAkB;EACxBE,IAAI,EAAE,eAAe;EACrBC,SAAS,EAAEL,cAAc;EACzBO,IAAI,EAAE;IAAEC,YAAY,EAAE,IAAI;IAAEC,aAAa,EAAE;EAAK,CAAC,CAAE;AACrD,CAAC,EACD;EACEP,IAAI,EAAE,uBAAuB;EAC7BE,IAAI,EAAE,gBAAgB;EACtBC,SAAS,EAAEL,cAAc;EACzBO,IAAI,EAAE;IAAEC,YAAY,EAAE,IAAI;IAAEC,aAAa,EAAE;EAAK,CAAC,CAAE;AACrD,CAAC,CACF;AAED,MAAMC,MAAM,GAAGhB,YAAY,CAAC;EAC1BiB,OAAO,EAAEhB,gBAAgB,CAACiB,OAAO,CAACC,GAAG,CAACC,QAAQ,CAAC;EAC/Cb;AACF,CAAC,CAAC;;AAEF;AACAS,MAAM,CAACK,UAAU,CAAC,CAACC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EACpC,MAAMC,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,CAAC;EAC7D,MAAMC,QAAQ,GAAG,CAAC,CAACL,QAAQ;EAC3B,MAAMM,OAAO,GAAGD,QAAQ,IAAIL,QAAQ,CAACM,OAAO,KAAK,CAAC;EAElD,IAAIT,EAAE,CAACU,OAAO,CAACC,IAAI,CAAEC,MAAM,IAAKA,MAAM,CAACrB,IAAI,CAACE,aAAa,CAAC,EAAE;IAC1D;IACA,IAAIgB,OAAO,EAAE;MACXP,IAAI,CAAC,CAAC,CAAC,CAAC;IACV,CAAC,MAAM,IAAIM,QAAQ,EAAE;MACnBK,KAAK,CAAC,OAAO,CAAC;MACdX,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;IACnB,CAAC,MAAM;MACLA,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;IAClB;EACF,CAAC,MAAM,IACLF,EAAE,CAACU,OAAO,CAACC,IAAI,CAAEC,MAAM,IAAKA,MAAM,CAACrB,IAAI,CAACC,YAAY,CAAC,IACrD,CAACgB,QAAQ,EACT;IACA;IACAN,IAAI,CAAC,QAAQ,CAAC;EAChB,CAAC,MAAM;IACLA,IAAI,CAAC,CAAC;EACR;AACF,CAAC,CAAC;AAEF,eAAeR,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}