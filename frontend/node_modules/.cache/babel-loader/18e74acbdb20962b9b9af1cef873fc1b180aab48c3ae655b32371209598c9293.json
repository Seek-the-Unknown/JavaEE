{"ast":null,"code":"import { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"detail-page\"\n};\nconst _hoisted_2 = {\n  key: 0\n};\nconst _hoisted_3 = {\n  key: 1\n};\nconst _hoisted_4 = {\n  class: \"venue-header\"\n};\nconst _hoisted_5 = {\n  class: \"header-content\"\n};\nconst _hoisted_6 = {\n  class: \"type-tag\"\n};\nconst _hoisted_7 = {\n  class: \"page-title\"\n};\nconst _hoisted_8 = {\n  class: \"booking-container\"\n};\nconst _hoisted_9 = {\n  class: \"info-cards\"\n};\nconst _hoisted_10 = {\n  class: \"info-card\"\n};\nconst _hoisted_11 = {\n  class: \"info-card\"\n};\nconst _hoisted_12 = {\n  class: \"booking-panel\"\n};\nconst _hoisted_13 = {\n  key: 0\n};\nconst _hoisted_14 = {\n  class: \"form-group\"\n};\nconst _hoisted_15 = {\n  class: \"time-slots-grid\"\n};\nconst _hoisted_16 = [\"onClick\"];\nconst _hoisted_17 = [\"disabled\"];\nconst _hoisted_18 = {\n  key: 1,\n  class: \"login-prompt\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"加载中...\")) : _createCommentVNode(\"v-if\", true), $setup.venue ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", {\n    class: \"header-image\",\n    style: _normalizeStyle({\n      backgroundImage: `url(${$setup.venue.imageUrl || `https://picsum.photos/seed/${$setup.venue.id}/1200/400`})`\n    })\n  }, null, 4 /* STYLE */), _createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"span\", _hoisted_6, _toDisplayString($setup.venue.type), 1 /* TEXT */), _createElementVNode(\"h1\", _hoisted_7, _toDisplayString($setup.venue.name), 1 /* TEXT */), _createElementVNode(\"p\", null, _toDisplayString($setup.venue.description), 1 /* TEXT */)])]), _createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"div\", _hoisted_9, [_createElementVNode(\"div\", _hoisted_10, [_cache[1] || (_cache[1] = _createElementVNode(\"span\", null, \"价格\", -1 /* CACHED */)), _createElementVNode(\"strong\", null, \"¥\" + _toDisplayString($setup.venue.pricePerHour) + \"/小时\", 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_11, [_cache[2] || (_cache[2] = _createElementVNode(\"span\", null, \"容量\", -1 /* CACHED */)), _createElementVNode(\"strong\", null, _toDisplayString($setup.venue.capacity) + \" 人\", 1 /* TEXT */)])]), _createElementVNode(\"div\", _hoisted_12, [_cache[7] || (_cache[7] = _createElementVNode(\"h3\", null, \"立即预约\", -1 /* CACHED */)), $setup.isLoggedIn ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [_createElementVNode(\"div\", _hoisted_14, [_cache[3] || (_cache[3] = _createElementVNode(\"label\", null, \"选择日期\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"date\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.selectedDate = $event)\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.selectedDate]])]), _cache[4] || (_cache[4] = _createElementVNode(\"label\", null, \"选择时段 (每小时)\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_15, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.timeSlots, slot => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: slot.time,\n      class: _normalizeClass([\"time-slot\", {\n        booked: slot.isBooked,\n        selected: $setup.selectedSlot === slot.time\n      }]),\n      onClick: $event => $setup.selectSlot(slot)\n    }, _toDisplayString(slot.time), 11 /* TEXT, CLASS, PROPS */, _hoisted_16);\n  }), 128 /* KEYED_FRAGMENT */))]), $setup.bookingMessage ? (_openBlock(), _createElementBlock(\"p\", {\n    key: 0,\n    class: _normalizeClass($setup.isError ? 'error-text' : 'success-text')\n  }, _toDisplayString($setup.bookingMessage), 3 /* TEXT, CLASS */)) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"button\", {\n    onClick: $setup.handleBooking,\n    class: \"book-btn\",\n    disabled: !$setup.selectedSlot || $setup.isBooking\n  }, _toDisplayString($setup.isBooking ? \"处理中...\" : `确认预约 ${$setup.selectedSlot || \"\"}`), 9 /* TEXT, PROPS */, _hoisted_17)])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_18, [_cache[6] || (_cache[6] = _createElementVNode(\"p\", null, \"请先登录以查看可预约时段并进行预约。\", -1 /* CACHED */)), _createVNode(_component_router_link, {\n    to: \"/login\",\n    class: \"book-btn\"\n  }, {\n    default: _withCtx(() => [...(_cache[5] || (_cache[5] = [_createTextVNode(\"前往登录\", -1 /* CACHED */)]))]),\n    _: 1 /* STABLE */\n  })]))])])])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","$setup","loading","_hoisted_2","venue","_hoisted_3","_createElementVNode","_hoisted_4","style","_normalizeStyle","imageUrl","id","_hoisted_5","_hoisted_6","_toDisplayString","type","_hoisted_7","name","description","_hoisted_8","_hoisted_9","_hoisted_10","pricePerHour","_hoisted_11","capacity","_hoisted_12","isLoggedIn","_hoisted_13","_hoisted_14","selectedDate","$event","_hoisted_15","_Fragment","_renderList","timeSlots","slot","key","time","_normalizeClass","isBooked","selectedSlot","onClick","selectSlot","_hoisted_16","bookingMessage","isError","handleBooking","disabled","isBooking","_hoisted_17","_hoisted_18","_createVNode","_component_router_link","to","_cache"],"sources":["F:\\Java_web_code\\frontend\\src\\views\\VenueDetailView.vue"],"sourcesContent":["<template>\n  <div class=\"detail-page\">\n    <div v-if=\"loading\">加载中...</div>\n    <div v-if=\"venue\">\n      <div class=\"venue-header\">\n        <div\n          class=\"header-image\"\n          :style=\"{\n            backgroundImage: `url(${\n              venue.imageUrl ||\n              `https://picsum.photos/seed/${venue.id}/1200/400`\n            })`,\n          }\"\n        ></div>\n        <div class=\"header-content\">\n          <span class=\"type-tag\">{{ venue.type }}</span>\n          <h1 class=\"page-title\">{{ venue.name }}</h1>\n          <p>{{ venue.description }}</p>\n        </div>\n      </div>\n\n      <div class=\"booking-container\">\n        <div class=\"info-cards\">\n          <div class=\"info-card\">\n            <span>价格</span><strong>¥{{ venue.pricePerHour }}/小时</strong>\n          </div>\n          <div class=\"info-card\">\n            <span>容量</span><strong>{{ venue.capacity }} 人</strong>\n          </div>\n        </div>\n\n        <div class=\"booking-panel\">\n          <h3>立即预约</h3>\n          <div v-if=\"isLoggedIn\">\n            <div class=\"form-group\">\n              <label>选择日期</label>\n              <input type=\"date\" v-model=\"selectedDate\" />\n            </div>\n            <label>选择时段 (每小时)</label>\n            <div class=\"time-slots-grid\">\n              <div\n                v-for=\"slot in timeSlots\"\n                :key=\"slot.time\"\n                class=\"time-slot\"\n                :class=\"{\n                  booked: slot.isBooked,\n                  selected: selectedSlot === slot.time,\n                }\"\n                @click=\"selectSlot(slot)\"\n              >\n                {{ slot.time }}\n              </div>\n            </div>\n            <p\n              v-if=\"bookingMessage\"\n              :class=\"isError ? 'error-text' : 'success-text'\"\n            >\n              {{ bookingMessage }}\n            </p>\n            <button\n              @click=\"handleBooking\"\n              class=\"book-btn\"\n              :disabled=\"!selectedSlot || isBooking\"\n            >\n              {{ isBooking ? \"处理中...\" : `确认预约 ${selectedSlot || \"\"}` }}\n            </button>\n          </div>\n          <div v-else class=\"login-prompt\">\n            <p>请先登录以查看可预约时段并进行预约。</p>\n            <router-link to=\"/login\" class=\"book-btn\">前往登录</router-link>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\n// ==================== 问题修复：移除了未使用的 reactive 和 useRouter ====================\nimport { ref, onMounted, computed, watch, defineProps } from \"vue\";\nimport { getVenueById } from \"@/api/venue\";\nimport { createOrder, getBookedSlots } from \"@/api/order\";\nimport { useUserStore } from \"@/store/user\";\n// ===================================================================================\n\nconst props = defineProps({ id: { type: [String, Number], required: true } });\nconst { userState, isLoggedIn } = useUserStore();\n\nconst venue = ref(null);\nconst loading = ref(true);\nconst isBooking = ref(false);\nconst bookingMessage = ref(\"\");\nconst isError = ref(false);\n\nconst selectedDate = ref(new Date().toISOString().split(\"T\")[0]);\nconst bookedSlots = ref([]);\nconst selectedSlot = ref(null);\n\n// 生成一天的时间段 (9:00 - 21:00)\nconst timeSlots = computed(() => {\n  const slots = [];\n  for (let i = 9; i < 22; i++) {\n    const time = `${String(i).padStart(2, \"0\")}:00`;\n    // 检查这个时间段是否已被预订\n    const isBooked = bookedSlots.value.some((booking) => {\n      const startTime = booking.startTime.substring(0, 5); // '09:00:00' -> '09:00'\n      return startTime === time;\n    });\n    slots.push({ time, isBooked });\n  }\n  return slots;\n});\n\n// 获取某日已预订时段\nconst fetchBookedSlots = async (date) => {\n  if (!isLoggedIn.value) return;\n  try {\n    const data = await getBookedSlots(props.id, date);\n    bookedSlots.value = data;\n    selectedSlot.value = null; // 日期改变后清空选择\n  } catch (error) {\n    console.error(\"获取已预约时段失败:\", error);\n  }\n};\n\n// 监听日期变化，重新获取数据\nwatch(selectedDate, (newDate) => {\n  fetchBookedSlots(newDate);\n});\n\n// 点击选择时间段\nconst selectSlot = (slot) => {\n  if (slot.isBooked) return; // 已被预订的不能选\n  selectedSlot.value = slot.time;\n};\n\nconst handleBooking = async () => {\n  if (!selectedSlot.value) {\n    alert(\"请先选择一个预约时间段！\");\n    return;\n  }\n  isBooking.value = true;\n  bookingMessage.value = \"\";\n\n  try {\n    const startTime = selectedSlot.value;\n    const endTime = `${(parseInt(startTime.split(\":\")[0]) + 1)\n      .toString()\n      .padStart(2, \"0\")}:00`;\n\n    await createOrder({\n      userId: userState.userInfo.id,\n      venueId: venue.value.id,\n      bookingDate: selectedDate.value,\n      startTime,\n      endTime,\n    });\n\n    isError.value = false;\n    bookingMessage.value = \"恭喜，预约成功！\";\n    alert('预约成功！您可以在\"我的订单\"页面查看。');\n    // 预约成功后刷新当前页的预订状态\n    fetchBookedSlots(selectedDate.value);\n  } catch (error) {\n    isError.value = true;\n    bookingMessage.value = error.message || \"预约失败，请稍后再试。\";\n  } finally {\n    isBooking.value = false;\n  }\n};\n\nonMounted(async () => {\n  try {\n    loading.value = true;\n    venue.value = await getVenueById(props.id);\n    await fetchBookedSlots(selectedDate.value); // 初始加载当天的预订\n  } catch (error) {\n    console.error(\"获取场馆详情失败:\", error);\n  } finally {\n    loading.value = false;\n  }\n});\n</script>\n\n<style scoped>\n.venue-header {\n  position: relative;\n  border-radius: var(--border-radius);\n  overflow: hidden;\n  margin-bottom: 32px;\n}\n.header-image {\n  height: 300px;\n  background-size: cover;\n  background-position: center;\n}\n.header-content {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  padding: 60px 32px 32px;\n  background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);\n  color: white;\n}\n.header-content .page-title {\n  margin: 8px 0;\n  color: white;\n}\n.header-content p {\n  margin: 0;\n  opacity: 0.9;\n}\n\n.booking-container {\n  display: grid;\n  grid-template-columns: 1fr 350px;\n  gap: 32px;\n}\n.info-cards {\n  background: var(--card-bg);\n  padding: 32px;\n  border-radius: var(--border-radius);\n  box-shadow: 0 4px 6px -1px var(--shadow-color);\n  align-self: flex-start; /* 关键，让它不拉伸 */\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 20px;\n}\n.info-card span {\n  display: block;\n  color: var(--text-secondary);\n  margin-bottom: 8px;\n}\n.info-card strong {\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.booking-panel {\n  background: var(--card-bg);\n  padding: 32px;\n  border-radius: var(--border-radius);\n  box-shadow: 0 4px 6px -1px var(--shadow-color);\n}\n.booking-panel h3 {\n  margin: 0 0 24px;\n  font-size: 20px;\n}\n.form-group {\n  margin-bottom: 16px;\n}\n.form-group label,\n.booking-panel > label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 500;\n  font-size: 14px;\n}\n.form-group input {\n  width: 100%;\n  padding: 10px;\n  border: 1px solid var(--border-color);\n  border-radius: 6px;\n  box-sizing: border-box;\n}\n\n.time-slots-grid {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 8px;\n  margin-bottom: 24px;\n}\n.time-slot {\n  padding: 8px;\n  border: 1px solid var(--border-color);\n  border-radius: 6px;\n  text-align: center;\n  cursor: pointer;\n}\n.time-slot.booked {\n  background: #f1f5f9;\n  color: #94a3b8;\n  cursor: not-allowed;\n  text-decoration: line-through;\n}\n.time-slot.selected {\n  background: var(--primary-color);\n  color: white;\n  border-color: var(--primary-color);\n}\n\n.book-btn {\n  width: 100%;\n  padding: 12px;\n  border: none;\n  border-radius: 6px;\n  background: var(--primary-color);\n  color: white;\n  font-size: 16px;\n  cursor: pointer;\n  text-align: center;\n  text-decoration: none;\n}\n.book-btn:disabled {\n  background: #cbd5e1;\n  cursor: not-allowed;\n}\n\n.error-text {\n  color: #ef4444;\n}\n.success-text {\n  color: #22c55e;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}