{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted, computed } from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport VenueForm from \"@/components/VenueForm.vue\";\nimport { getVenueById, createVenue, updateVenue, uploadImage } from \"@/api/venue\";\nexport default {\n  __name: 'AdminVenueEdit',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n\n    // ... <script setup> 部分保持不变 ...\n    const route = useRoute();\n    const router = useRouter();\n    const venueData = ref({\n      imageUrl: \"\"\n    });\n    const isLoading = ref(false);\n    const errorMessage = ref(\"\");\n    const isUploading = ref(false);\n    const imagePreview = ref(\"\");\n    const fileInput = ref(null);\n    const isEditMode = computed(() => !!route.params.id);\n    const venueId = computed(() => route.params.id);\n    const triggerFileUpload = () => {\n      fileInput.value.click();\n    };\n    const handleFileChange = async event => {\n      const file = event.target.files[0];\n      if (!file) return;\n      const reader = new FileReader();\n      reader.onload = e => {\n        imagePreview.value = e.target.result;\n      };\n      reader.readAsDataURL(file);\n      isUploading.value = true;\n      try {\n        venueData.value.imageUrl = await uploadImage(file);\n      } catch (error) {\n        errorMessage.value = \"图片上传失败: \" + error.message;\n      } finally {\n        isUploading.value = false;\n      }\n    };\n    const saveVenue = async formData => {\n      isLoading.value = true;\n      errorMessage.value = \"\";\n      const finalData = {\n        ...formData,\n        imageUrl: venueData.value.imageUrl\n      };\n      try {\n        if (isEditMode.value) {\n          await updateVenue(venueId.value, finalData);\n          alert(\"场馆更新成功！\");\n        } else {\n          await createVenue(finalData);\n          alert(\"场馆新增成功！\");\n        }\n        router.push(\"/venues\");\n      } catch (error) {\n        errorMessage.value = error.message || \"操作失败\";\n      } finally {\n        isLoading.value = false;\n      }\n    };\n    onMounted(async () => {\n      if (isEditMode.value) {\n        isLoading.value = true;\n        try {\n          const data = await getVenueById(venueId.value);\n          venueData.value = data;\n          if (data.imageUrl) {\n            imagePreview.value = data.imageUrl;\n          }\n        } catch (error) {\n          errorMessage.value = \"加载场馆数据失败\";\n        } finally {\n          isLoading.value = false;\n        }\n      }\n    });\n    const __returned__ = {\n      route,\n      router,\n      venueData,\n      isLoading,\n      errorMessage,\n      isUploading,\n      imagePreview,\n      fileInput,\n      isEditMode,\n      venueId,\n      triggerFileUpload,\n      handleFileChange,\n      saveVenue,\n      ref,\n      onMounted,\n      computed,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      VenueForm,\n      get getVenueById() {\n        return getVenueById;\n      },\n      get createVenue() {\n        return createVenue;\n      },\n      get updateVenue() {\n        return updateVenue;\n      },\n      get uploadImage() {\n        return uploadImage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","useRoute","useRouter","VenueForm","getVenueById","createVenue","updateVenue","uploadImage","route","router","venueData","imageUrl","isLoading","errorMessage","isUploading","imagePreview","fileInput","isEditMode","params","id","venueId","triggerFileUpload","value","click","handleFileChange","event","file","target","files","reader","FileReader","onload","e","result","readAsDataURL","error","message","saveVenue","formData","finalData","alert","push","data"],"sources":["F:/Java_web_code/frontend/src/views/AdminVenueEdit.vue"],"sourcesContent":["<template>\n  <div class=\"admin-edit-page\">\n    <header class=\"page-header\">\n      <div>\n        <h1 class=\"page-title\">{{ isEditMode ? \"编辑场馆\" : \"新增场馆\" }}</h1>\n        <p class=\"page-subtitle\">填写场馆信息并上传图片</p>\n      </div>\n      <router-link to=\"/venues\" class=\"back-link\">返回列表 &rarr;</router-link>\n    </header>\n\n    <div class=\"content-grid\">\n      <!-- 左侧图片上传 -->\n      <div class=\"card\">\n        <h2 class=\"card-title\">场馆图片</h2>\n        <div class=\"image-uploader\" @click=\"triggerFileUpload\">\n          <img\n            v-if=\"imagePreview\"\n            :src=\"imagePreview\"\n            alt=\"场馆预览\"\n            class=\"preview-image\"\n          />\n          <div v-else class=\"upload-placeholder\">\n            <div class=\"upload-icon-wrapper\">\n              <i class=\"icon icon-upload\"></i>\n            </div>\n            <p class=\"upload-text\">点击上传图片</p>\n            <p class=\"upload-hint\">支持 JPG, PNG 格式</p>\n          </div>\n          <input\n            type=\"file\"\n            ref=\"fileInput\"\n            @change=\"handleFileChange\"\n            accept=\"image/*\"\n            style=\"display: none\"\n          />\n        </div>\n        <div v-if=\"isUploading\" class=\"upload-status\">图片上传中...</div>\n      </div>\n\n      <!-- 右侧表单 -->\n      <div class=\"card\">\n        <VenueForm\n          :initial-data=\"venueData\"\n          :is-loading=\"isLoading\"\n          :error-message=\"errorMessage\"\n          @submit=\"saveVenue\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\n// ... <script setup> 部分保持不变 ...\nimport { ref, onMounted, computed } from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport VenueForm from \"@/components/VenueForm.vue\";\nimport {\n  getVenueById,\n  createVenue,\n  updateVenue,\n  uploadImage,\n} from \"@/api/venue\";\n\nconst route = useRoute();\nconst router = useRouter();\n\nconst venueData = ref({ imageUrl: \"\" });\nconst isLoading = ref(false);\nconst errorMessage = ref(\"\");\nconst isUploading = ref(false);\nconst imagePreview = ref(\"\");\nconst fileInput = ref(null);\n\nconst isEditMode = computed(() => !!route.params.id);\nconst venueId = computed(() => route.params.id);\n\nconst triggerFileUpload = () => {\n  fileInput.value.click();\n};\nconst handleFileChange = async (event) => {\n  const file = event.target.files[0];\n  if (!file) return;\n  const reader = new FileReader();\n  reader.onload = (e) => {\n    imagePreview.value = e.target.result;\n  };\n  reader.readAsDataURL(file);\n\n  isUploading.value = true;\n  try {\n    venueData.value.imageUrl = await uploadImage(file);\n  } catch (error) {\n    errorMessage.value = \"图片上传失败: \" + error.message;\n  } finally {\n    isUploading.value = false;\n  }\n};\n\nconst saveVenue = async (formData) => {\n  isLoading.value = true;\n  errorMessage.value = \"\";\n  const finalData = { ...formData, imageUrl: venueData.value.imageUrl };\n\n  try {\n    if (isEditMode.value) {\n      await updateVenue(venueId.value, finalData);\n      alert(\"场馆更新成功！\");\n    } else {\n      await createVenue(finalData);\n      alert(\"场馆新增成功！\");\n    }\n    router.push(\"/venues\");\n  } catch (error) {\n    errorMessage.value = error.message || \"操作失败\";\n  } finally {\n    isLoading.value = false;\n  }\n};\n\nonMounted(async () => {\n  if (isEditMode.value) {\n    isLoading.value = true;\n    try {\n      const data = await getVenueById(venueId.value);\n      venueData.value = data;\n      if (data.imageUrl) {\n        imagePreview.value = data.imageUrl;\n      }\n    } catch (error) {\n      errorMessage.value = \"加载场馆数据失败\";\n    } finally {\n      isLoading.value = false;\n    }\n  }\n});\n</script>\n\n<style scoped>\n@import url(\"@/assets/icons.css\");\n.icon-upload {\n  mask-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'%3E%3C/path%3E%3Cpolyline points='17 8 12 3 7 8'%3E%3C/polyline%3E%3Cline x1='12' y1='3' x2='12' y2='15'%3E%3C/line%3E%3C/svg%3E\");\n}\n\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 32px;\n}\n.page-subtitle {\n  color: var(--color-text-secondary);\n  margin-top: 8px;\n}\n.back-link {\n  color: var(--color-primary);\n  text-decoration: none;\n  font-weight: 500;\n}\n\n.content-grid {\n  display: grid;\n  grid-template-columns: 320px 1fr;\n  gap: 32px;\n}\n.card {\n  background: #fff;\n  padding: 24px;\n  border-radius: var(--border-radius-lg);\n  border: 1px solid var(--color-border);\n}\n.card-title {\n  font-size: 16px;\n  font-weight: 600;\n  margin: 0 0 16px;\n}\n\n.image-uploader {\n  aspect-ratio: 1 / 1;\n  border: 2px dashed var(--color-border);\n  border-radius: var(--border-radius-lg);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n  overflow: hidden;\n  transition: border-color 0.3s;\n}\n.image-uploader:hover {\n  border-color: var(--color-primary);\n}\n.preview-image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n.upload-placeholder {\n  text-align: center;\n}\n.upload-icon-wrapper {\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  background: #f8fafc;\n  color: var(--color-primary);\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  margin-bottom: 12px;\n}\n.upload-text {\n  font-weight: 500;\n  margin: 0 0 4px;\n}\n.upload-hint {\n  font-size: 12px;\n  color: var(--color-text-secondary);\n  margin: 0;\n}\n.upload-status {\n  margin-top: 10px;\n  color: var(--color-text-secondary);\n  font-size: 14px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}